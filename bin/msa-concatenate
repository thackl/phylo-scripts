#!/usr/bin/env perl
# Created: 08 Dec 2017
# Author: Thomas Hackl, thackl@lim4.de
use warnings;
use strict;

use Fasta::Parser;
use Data::Dumper;

my @msas = @ARGV;

my %C;
my %O;
foreach my $msa (@msas) {
    my %M;
    my $fp = Fasta::Parser->new(file => $msa);
    while (my $fa = $fp->next_seq) {
        my ($org_id) = $fa->id =~ /^([^|]+)/;
        $M{$org_id}= $fa->seq;
        $O{$org_id}++;
    }
    $C{$msa} = \%M;
}
print Dumper(\%O, \%C);

my %R;
foreach my $org (sort keys %O) {
    $R{$org} = '';
    foreach my $msa(@msas) {
        my $seq = exists $C{$msa}{$org}
            ? $C{$msa}{$org}
            : blank_seq($msa);
        $R{$org}.= $seq;
    }
}
print Dumper(\%R);

foreach (sort keys %R) {
    print Fasta::Seq->new(
        id => $_,
        seq => $R{$_})
}


sub blank_seq{
    my ($msa) = @_;
    my ($k, $s) = each %{$C{$msa}}; # get random seq
    print $k, $s;
    return "-" x length($s);
}
